<!doctype html>
<html><head><meta charset="utf-8"></head><body>

<!-- Fully self-contained quine -->

<div>
<big contenteditable="true">Hel-lo <span style="color:blue">W</span>or-l-d!
<span style="color:red">♥</span></big>
<button onclick="javascript:this.parentNode.parentNode.insertBefore(this.parentNode.cloneNode(true),this.parentNode)">Clone</button>
<button onclick="javascript:this.parentNode.parentNode.removeChild(this.parentNode)">Delete</button>
<button onclick="javascript:if(this.parentNode.firstChild.nodeName=='TEXTAREA'){this.parentNode.innerHTML=this.parentNode.firstChild.value;}else{this.parentNode.innerHTML='<textarea'+atob('IA==')+'cols=80'+atob('IA==')+'rows=20>'+this.parentNode.innerHTML.replace(/</g,'&'+'lt;')+'</textarea>'+this.parentNode.innerHTML;}">Edit</button>
<button onclick="javascript:this.parentNode.innerHTML=this.parentNode.innerHTML+'<a'+atob('IA==')+'href=data:text/html;charset=UTF-8,'+encodeURIComponent('<!doctype html>'+atob('Cg==')+'<html><head><html><head><meta'+atob('IA==')+'charset='+atob('Ig==')+'utf-8'+atob('Ig==')+'></head><body><div>'+this.parentNode.innerHTML+'</div></body></html>')+'>Download</a>'">Save</button>
</div>

<!-- Implemented with CoffeeScript, de-obfuscating the code a bit! -->
<div>
<script type="text/javascript" src="http://js2coffee.org/scripts/coffeescript.min.js"></script>
<script type="text/coffeescript">
@editableQuine ?= {}
@editableQuine.k90gxo ?= {}
id = "editableQuine.k90gxo"
node = eval id
uniq = (x) ->
  do (i = id.replace(/.*[.]/, "")) ->
    ii = i
    while true
      ii = ((Math.random()*0x7fffffff)|0).toString(36)
      if /^[a-z]/.test ii
        unless editableQuine[ii]?
          break
    a = new Regexp("editableQuine[.]#{i}");
    b = "editableQuine.#{ii}"
    x.replace(a, b)
node.del = (x) -> x.parentNode.removeChild(x)
node.dup = (x) -> x.parentNode.insertBefore(x.cloneNode(true),x)
node.mod = (x) -> if x.firstChild.nodeName=='TEXTAREA'
  x.innerHTML=x.firstChild.value
else
  x.innerHTML='<textarea cols=80 rows=20>' + x.innerHTML.replace(/</g,'&'+'lt;') + '<' + '/textarea>' + x.innerHTML
node.sav = (x) -> x.innerHTML = x.innerHTML + '<a href=data:text/html;charset=UTF-8,'+encodeURIComponent('<!doctype html>
<html><head><meta charset="utf-8">
<style>*{background:black;color:white;}</style></head>
<body><div>'+x.innerHTML+'</div></body></html>')+'>Download</a>'
</script>
<span style="font-size:180%" contenteditable="true">Hel·lo <span style="color:blue">W</span>or·l·d!
<span style="color:red">♥</span> <small>(with CoffeeScript)</small></span>
<button onclick="javascript:editableQuine.k90gxo.dup(this.parentNode)">Clone</button>
<button onclick="javascript:editableQuine.k90gxo.del(this.parentNode)">Delete</button>
<button onclick="javascript:editableQuine.k90gxo.mod(this.parentNode)">Edit</button>
<button onclick="javascript:editableQuine.k90gxo.sav(this.parentNode)">Save</button>
</div>

<div>
<script type="text/javascript" src="http://ajaxorg.github.com/ace-builds/textarea/src/ace-bookmarklet.js"></script>
<script src="http://ajaxorg.github.com/ace-builds/textarea/src/theme-vibrant_ink.js"></script>
<script src="http://ajaxorg.github.com/ace-builds/textarea/src/mode-coffee.js"></script>
<script type="text/javascript" src="http://js2coffee.org/scripts/coffeescript.min.js"></script>
<script type="text/coffeescript">
@deleteNode = (x) -> x.parentNode.removeChild(x)
@duplicateNode = (x) -> x.parentNode.insertBefore(x.cloneNode(true),x)
@editNode = (x) -> if x.firstChild.nodeName=='TEXTAREA'
  x.innerHTML=x.firstChild.value
else
  x.innerHTML='<textarea cols=80 rows=20>' + x.innerHTML.replace(/</g,'&'+'lt;') + '<' + '/textarea>' + x.innerHTML
  ace = __ace_shadowed__
  ace.options =
        mode:             "coffee"
        theme:            "cobalt"
        gutter:           "true"
        fontSize:         "10px"
        softWrap:         "off"
        keybindings:      "ace"
        showPrintMargin:  "true"
        useSoftTabs:      "true"
        showInvisibles:   "false"
  jsload = (src, callback) ->
    log "Loading #{src}"
    x = document.createElement('script')
    x.type = 'text/javascript'
    x.src = src
    y = 1
    x.onload = x.onreadystatechange = () ->
      if y and not @readyState or @readyState is 'complete'
        log "Loaded #{src}"
        y = 0
        callback()
    document.getElementsByTagName('head')[0].appendChild x
  baseUrl = "http://ajaxorg.github.com/ace-builds/textarea/src/"
  load = window.__ace_loader__ = (path, module, callback) ->
    jsload baseUrl + path, ->
      window.__ace_shadowed__.require [module], callback
  textarea = x.firstChild
  editor = ace.transformTextarea x.firstChild, load
  editor.on "blur", -> textarea.value = editor.getValue()
  editor.setTheme "ace/theme/vibrant_ink"
  editor.getSession().setMode "ace/mode/coffee"
  editor.getSession().setTabSize 2
@saveNode = (x) -> x.innerHTML = x.innerHTML + '<a href=data:text/html;charset=UTF-8,'+encodeURIComponent('<!doctype html>
<html><head><meta charset="utf-8">
<style>body{background:black;color:white;}</style></head>
<body><div>'+x.innerHTML+'</div></body></html>')+'>Download</a>'
</script>
<span style="font-size:180%" contenteditable="true">Hel·lo <span style="color:blue">W</span>or·l·d!
<span style="color:red">♥</span> <small>(with CoffeeScript and ACE Editor)</small></span>
<button onclick="javascript:duplicateNode(this.parentNode)">Clone</button>
<button onclick="javascript:deleteNode(this.parentNode)">Delete</button>
<button onclick="javascript:editNode(this.parentNode)">Edit</button>
<button onclick="javascript:saveNode(this.parentNode)">Save</button>
</div>

</body></html>
